<!DOCTYPE html>
<html>
<head>
    <title>Attendance</title>
    <!-- Add Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Customize the UI */
        body {
            background-color: black;
           color: white;
        }
        .card {
            margin-top: 50px;
        }
        .table-responsive {
            margin-top: 20px;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0069d9;
            border-color: #0062cc;
        }
        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
		.table {
			font-size: 18px;
		}
		
		.table thead th {
			background-color: #007bff;
			color: #fff;
			border-color: #007bff;
		}
		
		.table tbody td {
			vertical-align: middle;
		}
		
		.table tbody tr:hover {
			background-color: #f8f9fa;
		}
		
		.table-active, .table-active:hover {
			background-color: #e9ecef !important;
		}
		
		.table td, .table th {
			padding: .75rem;
			vertical-align: top;
			border-top: 1px solid #dee2e6;
		}
		
		.table td:last-child, .table th:last-child {
			border-right: 0;
		}
		
		.table td:first-child, .table th:first-child {
			border-left: 0;
		}
		
		.table-bordered th, .table-bordered td {
			border: 1px solid #dee2e6;
		}
		
		.table-bordered thead th, .table-bordered thead td {
			border-bottom-width: 2px;
		}
		
		.table-dark {
			color: #fff;
			background-color: #343a40;
		}
		
		.table-dark th, .table-dark td, .table-dark thead th {
			border-color: #454d55;
		}
		
		.table-dark.table-bordered {
			border: 0;
		}
		
		.table-dark.table-bordered th, .table-dark.table-bordered td {
			border: 1px solid #454d55;
		}
		
		.table-hover tbody tr:hover {
			background-color: rgba(0, 0, 0, 0.075);
		}
		
		.table-primary, .table-primary > th, .table-primary > td {
			background-color: #007bff;
			color: #fff;
		}
		
		.table-hover .table-primary:hover {
			background-color: #0062cc;
		}
		
		.table-hover .table-primary:hover > td, .table-hover .table-primary:hover > th {
			background-color: #0062cc;
			color: #fff;
		}
		
		.table-secondary, .table-secondary > th, .table-secondary > td {
			background-color: #6c757d;
			color: #fff;
		}
		
		.table-hover .table-secondary:hover {
			background-color: #545b62;
		}
		
		.table-hover .table-secondary:hover > td, .table-hover .table-secondary:hover > th {
			background-color: #545b62;
			color: #fff;
		}
		
		.table-success, .table-success > th, .table-success > td {
			background-color: #28a745;
			color: #fff;
		}
		
		.table-hover .table-success:hover {
			background-color: #218838;
		}
		
		.table-hover .table-success:hover > td, .table-hover .table-success:hover > th {
			background-color: #218838;
			color: #fff;
		}
		
		.table-info, .table-info > th, .table-info > td {
			background-color: #17a2b8;
			color: #fff;
		}
		
		.table-hover .table-info:hover {
			background-color: #138496;
		}
		
		.table-hover .table-info:hover > td, .table-hover .table-info:hover > th {
			background-color: #138496;
			color: #fff;
		}
		
		.table-warning, .table-warning > th, .table-warning > td {
			background-color: #ffc107;
			color: #212529;
		}
		
		.table-hover .table-warning:hover {
			background-color: #e0a800;
		}
		
		.table-hover .table-warning:hover > td, .table-hover .table-warning:hover > th {
			background-color: #e0a800;
			color: #212529;
		}
		
		.table-danger, .table-danger > th, .table-danger > td {
			background-color: #dc3545;
			color: #fff;
		}
		
		.table-hover .table-danger:hover {
			background-color: #c82333;
		}
		
		.table-hover .table-danger:hover > td, .table-hover .table-danger:hover > th {
			background-color: #c82333;
			color: #fff;
		}
		
		.table-light, .table-light > th, .table-light > td {
			background-color: #f8f9fa;
		}
		
		.table-hover .table-light:hover {
			background-color: #e2e6ea;
		}
		
		.table-hover .table-light:hover > td, .table-hover .table-light:hover > th {
			background-color: #e2e6ea;
			color: #212529;
		}
		
		.table-dark, .table-dark > th, .table-dark > td {
			background-color: #343a40;
			color: #fff;
		}
		
		.table-hover .table-dark:hover {
			background-color: #23272b;
		}
		
		.table-hover .table-dark:hover > td, .table-hover .table-dark:hover > th {
			background-color: #23272b;
			color: #fff;
		}
		
		.table-active, .table-active > th, .table-active > td {
			background-color: rgba(0, 0, 0, 0.075);
		}
		
		.table-hover .table-active:hover {
			background-color: rgba(0, 0, 0, 0.075);
		}
		
		.table-hover .table-active:hover > td, .table-hover .table-active:hover > th {
			background-color: rgba(0, 0, 0, 0.075);
		}
		
		.table .thead-dark th {
			color: #fff;
			background-color: #343a40;
			border-color: #454d55;
		}
		
		.table .thead-light th {
			color: #495057;
			background-color: #e9ecef;
			border-color: #dee2e6;
		}
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-5">Attendance</h1>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h3>Teacher Name: <span id="teacherName"></span></h3>
                <h3>Class Start Time: <span id="classStartTime"></span></h3>
                <h3>Class End Time: <span id="classEndTime"></span></h3>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <div class="form-group">
                            <button class="btn btn-primary" id="startClassBtn">Start Class</button>
                            <button class="btn btn-danger" id="endClassBtn" disabled>End Class</button>
                        </div>
                        <div class="form-group">
                            <label for="teacherNameInput">Teacher Name:</label>
                            <input type="text" class="form-control" id="teacherNameInput">
                        </div>
                        <div class="embed-responsive embed-responsive-4by3">
                            <video id="preview" class="embed-responsive-item"></video>
                        </div>
                        <div class="table-responsive">
                            <table class="table mt-3">
                                <thead>
                                    <tr>
                                        <th>Student Name</th>
                                        <th>Registration Number</th>
                                        <th>Time In</th>
                                        <th>Time Out</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Attendance data will be added here -->
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-primary mt-3" onclick="printTable()">Print Attendance Table</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Bootstrap JS and Instascan JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.0.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier@3.4.0"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>
        let scanner = null;
        let students = {};
        let selectedRow = null;

        // Attach a click event listener to the start class button
        document.getElementById('startClassBtn').addEventListener('click', function() {
            document.getElementById('startClassBtn').disabled = true;
            document.getElementById('endClassBtn').disabled = false;
            let teacherName = document.getElementById('teacherNameInput').value;
            let classStartTime = new Date().toLocaleTimeString();
            document.getElementById('teacherName').innerText = teacherName;
            document.getElementById('classStartTime').innerText = classStartTime;
            document.getElementById('classEndTime').innerText = '';
            scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
            scanner.addListener('scan', function (content) {
                let parts = content.split(':');
                let studentName = parts[0];
                let registrationNumber = parts[1];
                let date = new Date().toLocaleDateString();
                let time = new Date().toLocaleTimeString();
                if (!students[registrationNumber]) {
                    // Prompt the user to confirm before adding the student to the attendance table
                    if (confirm(`Do you want to add ${studentName} (${registrationNumber}) to the attendance table?`)) {
                        students[registrationNumber] = { name: studentName, timeIn: time };
                        let table = document.querySelector('table tbody');
                        let row = table.insertRow(-1);
                        let nameCell = row.insertCell(0);
                        let regNoCell = row.insertCell(1);
                        let timeInCell = row.insertCell(2);
                        let timeOutCell = row.insertCell(3);
                        nameCell.innerHTML = studentName;
                        regNoCell.innerHTML = registrationNumber;
                        timeInCell.innerHTML = time;
                        timeOutCell.innerHTML = '-';
                        row.addEventListener('click', function() {
                            if (selectedRow) {
                                selectedRow.classList.remove('table-active');
                            }
                            selectedRow = row;
                            selectedRow.classList.add('table-active');
                        });
                    }
                } else {
                    students[registrationNumber].timeOut = time;
                    let rows = document.querySelectorAll('table tbody tr');
                    for (let i = 0; i < rows.length; i++) {
                        let cells = rows[i].getElementsByTagName('td');
                        if (cells[1].innerText === registrationNumber) {
                            cells[3].innerText = time;
                            break;
                        }
                    }
                }
            });
            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    scanner.start(cameras[0]);
                } else {
                    alert('No cameras found.');
                }
            }).catch(function (error) {
                console.error(error);
            });
        });

        // Attach a click event listener to the end class button
        document.getElementById('endClassBtn').addEventListener('click', function() {
            document.getElementById('startClassBtn').disabled = false;
            document.getElementById('endClassBtn').disabled = true;
            document.getElementById('classEndTime').innerText = new Date().toLocaleTimeString();
            scanner.stop();
        });

        // Define the printTable function
        function printTable() {
            let originalContents = document.body.innerHTML;
            let printContents = `
                <h1 class="text-center my-5">Attendance</h1>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <h3>Teacher Name: <span id="teacherNamePrint"></span></h3>
                        <h3>Class Start Time: <span id="classStartTimePrint"></span></h3>
                        <h3>Class End Time: <span id="classEndTimePrint"></span></h3>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table mt-3">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Registration Number</th>
                                <th>Time In</th>
                                <th>Time Out</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${document.querySelector('table tbody').innerHTML}
                        </tbody>
                    </table>
                </div>
            `;
            document.body.innerHTML = printContents;
            document.getElementById('teacherNamePrint').innerText = document.getElementById('teacherName').innerText;
            document.getElementById('classStartTimePrint').innerText = document.getElementById('classStartTime').innerText;
            document.getElementById('classEndTimePrint').innerText = document.getElementById('classEndTime').innerText;
            document.querySelectorAll('.btn').forEach(function(btn) {
                btn.style.display = 'none';
            });
            window.print();
            document.body.innerHTML = originalContents;
        }
    </script>
</body>
</html>
